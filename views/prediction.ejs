<%- include('partials/header') %>

<div class="prediction-page fade-in">
  <h2>Crop Yield Prediction</h2>
  <p>Enter your farm details to get an AI-powered yield prediction</p>
  
  <div class="card">
    <form id="predictionForm">
      <div class="form-group">
        <label for="crop">Crop Type</label>
        <select id="crop" name="crop" required>
          <option value="">Select a crop</option>
          <option value="rice">Rice</option>
          <option value="wheat">Wheat</option>
          <option value="maize">Maize</option>
          <option value="cotton">Cotton</option>
          <option value="sugarcane">Sugarcane</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="area">Farm Area (hectares)</label>
        <input type="number" id="area" name="area" min="0.1" step="0.1" required>
      </div>
      
      <div class="form-group">
        <label for="soilType">Soil Type</label>
        <select id="soilType" name="soilType" required>
          <option value="">Select soil type</option>
          <option value="clay">Clay</option>
          <option value="loamy">Loamy</option>
          <option value="sandy">Sandy</option>
          <option value="silt">Silt</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="season">Growing Season</label>
        <select id="season" name="season" required>
          <option value="">Select season</option>
          <option value="kharif">Kharif (Monsoon)</option>
          <option value="rabi">Rabi (Winter)</option>
          <option value="zaid">Zaid (Summer)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="location">Farm Location</label>
        <input type="text" id="location" name="location" placeholder="Enter district or village name" required>
      </div>
      
      <button type="submit" class="btn">Predict Yield</button>
    </form>
  </div>
  
  <div class="card" id="predictionResult" style="display: none;">
    <h3>Prediction Result</h3>
    <div id="resultContent"></div>
  </div>
  
  <div class="card">
    <h3>Weather Information</h3>
    <div class="weather-form">
      <div class="form-group">
        <label for="weatherLocation">Get Weather for:</label>
        <input type="text" id="weatherLocation" placeholder="Enter location">
      </div>
      <button id="getWeather" class="btn btn-secondary">Get Weather</button>
    </div>
    <div id="weatherResult"></div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const predictionForm = document.getElementById('predictionForm');
    const predictionResult = document.getElementById('predictionResult');
    const resultContent = document.getElementById('resultContent');
    
    predictionForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(predictionForm);
      const data = Object.fromEntries(formData);
      
      try {
        // Show loading state
        resultContent.innerHTML = '<p>Calculating prediction...</p>';
        predictionResult.style.display = 'block';
        
        // Send prediction request
        const response = await fetch('/api/predict', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Display prediction result
          resultContent.innerHTML = `
            <div class="prediction-summary">
              <div class="prediction-item">
                <h4>Crop</h4>
                <p>${result.crop}</p>
              </div>
              <div class="prediction-item">
                <h4>Predicted Yield</h4>
                <p>${result.predictedYield} tons per hectare</p>
              </div>
              <div class="prediction-item">
                <h4>Confidence Level</h4>
                <p>${result.confidence}</p>
              </div>
            </div>
            
            <div class="recommendations">
              <h4>Recommendations:</h4>
              <ul>
                ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
              </ul>
            </div>
          `;
        } else {
          resultContent.innerHTML = `<p class="error">${result.error || 'Prediction failed'}</p>`;
        }
      } catch (error) {
        console.error('Error:', error);
        resultContent.innerHTML = '<p class="error">An error occurred during prediction</p>';
      }
    });
  });
</script>

<%- include('partials/footer') %>
